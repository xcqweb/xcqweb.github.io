(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d0e1c0c"],{"7c7a":function(t,e,o){"use strict";o.r(e);var i=o("768b"),l=(o("ac6a"),o("5d73")),n=o.n(l),a=(o("7f7f"),o("15b8")),r=o.n(a),c=o("880a"),s={data:function(){var t=this;return{loading:!1,modalTitle:"",indeterminate:!1,checkAll:!1,checkAllGroup:[],moduleList:[],pageSize:10,totalCount:0,currentPage:1,menuAuthStatus:!1,searchKey:"",isLoading:!1,addRoleStatus:!1,editRoleStatus:!1,roleAdd:{roleName:"",roleDirection:""},roleEdit:{roleName:"",roleDirection:"",id:"",index:""},updateAuthMenuStr:"",updateAuthModuleStr:"",currentRoleId:"",moduleAuthStatus:!1,treeData:[],columnsRole:r()([{title:"序号",width:80,type:"index",render:function(t,e){return t("div",[t("Icon",{props:{type:"person"}}),t("strong",e.row.name)])}},{title:"角色名称",key:"RoleName"},{title:"角色说明",key:"Directions"},{title:"操作",key:"action",width:500,align:"center",render:function(e,o){return e("div",[e("i-button",{props:{type:"primary",icon:"md-create"},style:{margin:"8px"},on:{click:function(){t.edit(o)}}},"编辑"),e("i-button",{props:{type:"primary",icon:"ios-create-outline"},style:{margin:"8px"},on:{click:function(){t.menuAuthAssign(o)}}},"菜单权限分配"),e("i-button",{props:{type:"primary",icon:"ios-create-outline"},style:{margin:"8px"},on:{click:function(){t.moduleAuthAssign(o)}}},"模块权限分配"),e("i-button",{props:{type:"error",icon:"ios-trash-outline"},style:{margin:"8px"},on:{click:function(){t.remove(o)}}},"删除")])}}]),dataRole:[]}},activated:function(){this.getRoleList()},beforeDestroy:function(){this.$root.eventBus.$off("getMenu")},methods:{handleCheckAll:function(){if(this.checkAll=!this.checkAll,this.checkAllGroup=[],this.updateAuthModuleStr="",this.checkAll){var t=!0,e=!1,o=void 0;try{for(var i,l=n()(this.moduleList);!(t=(i=l.next()).done);t=!0){var a=i.value;this.checkAllGroup.push(a.ModuleName)}}catch(t){e=!0,o=t}finally{try{t||null==l.return||l.return()}finally{if(e)throw o}}this.getSelectedModule()}},queryAuthMenu:function(t){var e=this;Object(c.w)({roleId:t}).then(function(t){e.treeData=r()(t.data.menuList),function t(e){var o=!0,i=!1,l=void 0;try{for(var a,r=n()(e);!(o=(a=r.next()).done);o=!0){var c=a.value;c.children&&c.children.length>0&&(delete c.checked,t(c.children))}}catch(t){i=!0,l=t}finally{try{o||null==r.return||r.return()}finally{if(i)throw l}}}(e.treeData)})},search:debounce(function(){this.getRoleList()},600,{leading:!0}),addRole:function(){var t=this;this.addRoleStatus=!0,this.roleAdd.roleName&&this.roleAdd.roleDirection?(this.loading=!0,Object(c.c)({roleName:this.roleAdd.roleName,direction:this.roleAdd.roleDirection}).then(function(e){t.loading=!1,t.addRoleStatus=!1,t.roleAdd={roleName:"",roleDirection:""},t.getRoleList()})):this.$Message.warning({content:"角色名和角色说明不能为空!",duration:3})},editRole:function(){var t=this;this.roleEdit.roleName&&this.roleEdit.roleDirection?(this.loading=!0,Object(c.q)({roleName:this.roleEdit.roleName,direction:this.roleEdit.roleDirection,id:this.roleEdit.id}).then(function(e){t.loading=!1,t.editRoleStatus=!1,t.$set(t.dataRole[t.roleEdit.index],"RoleName",t.roleEdit.roleName),t.$set(t.dataRole[t.roleEdit.index],"Directions",t.roleEdit.roleDirection)})):this.$Message.warning({content:"角色名和角色说明不能为空!",duration:3})},getRoleList:function(t){var e=this;this.isLoading=!0,Object(c.D)({key:this.searchKey,currentPage:this.currentPage,pageSize:this.pageSize}).then(function(t){e.isLoading=!1,e.dataRole=t.data.roleList,e.totalCount=t.data.total},function(t){e.isLoading=!1})},edit:function(t){this.modalTitle="编辑角色 - ".concat(t.row.Directions),this.editRoleStatus=!0,this.roleEdit={roleName:t.row.RoleName,roleDirection:t.row.Directions,id:t.row.RoleId,index:t.index}},remove:function(t){var e=this;this.$Modal.confirm({title:"提示",loading:!0,closable:!0,content:"<p>确定要要删除 <span style='color:#2d8cf0;'>".concat(t.row.RoleName,"</span> 角色?</p>"),onOk:function(){Object(c.l)({id:t.row.RoleId}).then(function(o){e.$Modal.remove(),e.dataRole.splice(t.index,1)})}})},moduleAuthAssign:function(t){var e=this;this.modalTitle="模块权限分配 - ".concat(t.row.Directions),this.checkAllGroup=[],this.checkAll=!1,this.moduleAuthStatus=!0,this.currentRoleId=t.row.RoleId,Object(c.x)({roleId:t.row.RoleId,isAdmin:!0}).then(function(t){e.moduleList=r()(t.data.muduleList);var o=!0,i=!1,l=void 0;try{for(var a,c=n()(e.moduleList);!(o=(a=c.next()).done);o=!0){var s=a.value;s.selected&&e.checkAllGroup.push(s.ModuleName)}}catch(t){i=!0,l=t}finally{try{o||null==c.return||c.return()}finally{if(i)throw l}}e.ModulecheckedChange()})},moduleAuthHandler:function(){var t=this;this.loading=!0,Object(c.j)({str:this.updateAuthModuleStr,roleId:this.currentRoleId}).then(function(e){t.loading=!1,t.moduleAuthStatus=!1})},menuAuthAssign:function(t){var e=t.row,o=e.RoleId,i=e.Directions;this.modalTitle="菜单权限分配 - ".concat(i),this.menuAuthStatus=!0,this.currentRoleId=o,this.queryAuthMenu(o)},ModulecheckedChange:function(){var t=this.moduleList.length;this.checkAllGroup.length===t?this.checkAll=!0:this.checkAll=!1,this.getSelectedModule()},getSelectedModule:function(){var t="",e=this.checkAllGroup.length-1,o=!0,l=!1,a=void 0;try{for(var r,c=n()(this.checkAllGroup.entries());!(o=(r=c.next()).done);o=!0){var s=Object(i.a)(r.value,2),d=s[0],u=s[1],h=!0,m=!1,p=void 0;try{for(var g,f=n()(this.moduleList);!(h=(g=f.next()).done);h=!0){var v=g.value;v.ModuleName===u&&(t+="(".concat(this.currentRoleId,",").concat(v.ModuleId,")").concat(d===e?"":","))}}catch(t){m=!0,p=t}finally{try{h||null==f.return||f.return()}finally{if(m)throw p}}}}catch(t){l=!0,a=t}finally{try{o||null==c.return||c.return()}finally{if(l)throw a}}this.updateAuthModuleStr=t},checkedChange:function(){var t=this.$refs.MenuTree.getCheckedAndIndeterminateNodes(),e=t.length-1,o="",l=!0,a=!1,r=void 0;try{for(var c,s=n()(t.entries());!(l=(c=s.next()).done);l=!0){var d=Object(i.a)(c.value,2),u=d[0],h=d[1];o+="(".concat(this.currentRoleId,",").concat(h.id,")").concat(u===e?"":",")}}catch(t){a=!0,r=t}finally{try{l||null==s.return||s.return()}finally{if(a)throw r}}this.updateAuthMenuStr=o},menuAuthHandler:function(){var t=this;this.loading=!0,this.checkedChange(),Object(c.E)({str:this.updateAuthMenuStr,roleId:this.currentRoleId}).then(function(e){t.loading=!1,t.menuAuthStatus=!1,t.currentRoleId===t.userInfo.RoleId&&t.$root.eventBus.$emit("getMenu")})},goPage:function(t){this.currentPage=t,this.getRoleList()}}},d=o("2877"),u=Object(d.a)(s,function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"roleManage"},[o("div",{staticClass:"top_operate"},[o("i-input",{staticStyle:{width:"300px","margin-right":"30px"},attrs:{search:"","enter-button":"",size:"large",placeholder:"角色查询"},on:{"on-search":t.search,"on-enter":t.search},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}}),o("i-button",{attrs:{size:"large",icon:"ios-add",type:"primary"},on:{click:function(e){t.addRoleStatus=!0}}},[t._v("新增角色")])],1),o("i-table",{directives:[{name:"show",rawName:"v-show",value:t.dataRole.length,expression:"dataRole.length"}],attrs:{border:"",stripe:"",size:"large",loading:t.isLoading,columns:t.columnsRole,data:t.dataRole}}),o("i-page",{staticStyle:{margin:"20px 0"},attrs:{total:t.totalCount,cureent:t.currentPage,"show-total":"","page-size":t.pageSize,"show-elevator":""},on:{"on-change":t.goPage}}),o("i-modal",{attrs:{title:"新增角色"},model:{value:t.addRoleStatus,callback:function(e){t.addRoleStatus=e},expression:"addRoleStatus"}},[o("div",{attrs:{slot:"footer"},slot:"footer"},[o("i-button",{on:{click:function(e){t.addRoleStatus=!1}}},[t._v("取消")]),o("i-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.addRole}},[t._v("确定")])],1),o("div",{staticClass:"center_g marginTop10"},[o("p",{staticClass:"label_g"},[t._v("角色名称")]),o("i-input",{attrs:{placeholder:"请输入角色名..."},model:{value:t.roleAdd.roleName,callback:function(e){t.$set(t.roleAdd,"roleName",e)},expression:"roleAdd.roleName"}})],1),o("div",{staticClass:"center_g marginTop10"},[o("p",{staticClass:"label_g"},[t._v("角色说明")]),o("i-input",{attrs:{type:"textarea",autosize:"",placeholder:"请输入角色说明..."},model:{value:t.roleAdd.roleDirection,callback:function(e){t.$set(t.roleAdd,"roleDirection",e)},expression:"roleAdd.roleDirection"}})],1)]),o("i-modal",{attrs:{title:t.modalTitle},model:{value:t.editRoleStatus,callback:function(e){t.editRoleStatus=e},expression:"editRoleStatus"}},[o("div",{attrs:{slot:"footer"},slot:"footer"},[o("i-button",{on:{click:function(e){t.editRoleStatus=!1}}},[t._v("取消")]),o("i-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.editRole}},[t._v("确定")])],1),o("div",{staticClass:"center_g marginTop10"},[o("p",{staticClass:"label_g"},[t._v("角色名称")]),o("i-input",{attrs:{placeholder:"请输入角色名..."},model:{value:t.roleEdit.roleName,callback:function(e){t.$set(t.roleEdit,"roleName",e)},expression:"roleEdit.roleName"}})],1),o("div",{staticClass:"center_g marginTop10"},[o("p",{staticClass:"label_g"},[t._v("角色说明")]),o("i-input",{attrs:{type:"textarea",autosize:"",placeholder:"请输入角色说明..."},model:{value:t.roleEdit.roleDirection,callback:function(e){t.$set(t.roleEdit,"roleDirection",e)},expression:"roleEdit.roleDirection"}})],1)]),o("i-modal",{attrs:{title:t.modalTitle,width:"600"},model:{value:t.menuAuthStatus,callback:function(e){t.menuAuthStatus=e},expression:"menuAuthStatus"}},[o("div",{attrs:{slot:"footer"},slot:"footer"},[o("i-button",{on:{click:function(e){t.menuAuthStatus=!1}}},[t._v("取消")]),o("i-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.menuAuthHandler}},[t._v("确定")])],1),o("i-tree",{ref:"MenuTree",attrs:{data:t.treeData,"show-checkbox":"",multiple:""},on:{"on-check-change":t.checkedChange}})],1),o("i-modal",{attrs:{title:t.modalTitle,width:"800"},model:{value:t.moduleAuthStatus,callback:function(e){t.moduleAuthStatus=e},expression:"moduleAuthStatus"}},[o("div",{attrs:{slot:"footer"},slot:"footer"},[o("i-button",{on:{click:function(e){t.moduleAuthStatus=!1}}},[t._v("取消")]),o("i-button",{attrs:{type:"primary",loading:t.loading},on:{click:t.moduleAuthHandler}},[t._v("确定")])],1),o("div",{staticStyle:{"border-bottom":"1px solid #e9e9e9","padding-bottom":"6px","margin-bottom":"6px"}},[o("i-checkbox",{attrs:{indeterminate:t.indeterminate,value:t.checkAll,size:"large"},nativeOn:{click:function(e){return e.preventDefault(),t.handleCheckAll(e)}}},[t._v(t._s(t.checkAll?"取消全选":"全选"))])],1),o("i-checkbox-group",{on:{"on-change":t.ModulecheckedChange},model:{value:t.checkAllGroup,callback:function(e){t.checkAllGroup=e},expression:"checkAllGroup"}},t._l(t.moduleList,function(t){return o("i-checkbox",{key:t.ModuleId,attrs:{size:"large",label:t.ModuleName}})}),1)],1)],1)},[],!1,null,null,null);e.default=u.exports}}]);